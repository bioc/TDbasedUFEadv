---
title: "QuickStart2"
author:
- name: Y-h. Taguchi
  affiliation:  Department of Physics, Chuo University, Tokyo 112-8551, Japan
  email: tag@granular.com
output:   
    BiocStyle::html_document:
    toc: true
bibliography: references.bib
vignette: >
  %\VignetteIndexEntry{QuickStart2}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r style, echo = FALSE, results = 'asis'}
BiocStyle::markdown()
```

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(TDbasedUFEadv)
```

# Integrated analysis of multiple omics data

## When samples are shared

As an alternative approch that can integrate multiple omics that share sample, 
we propose the method that makes use of projection provided by SVD.

We prepare a tensor that is a bundle of the first ten singular value vectors 
generated by applying SVD to individual omics profiles.

```{r}
require(MOFAdata)
data("CLL_data")
data("CLL_covariates")
Z <- prepareTensorfromList(CLL_data,10)
Z <- PrepareSummarizedExperimentTensor(feature = character("1"),
    sample=array(colnames(CLL_data$Drugs),1),value=Z,
    sampleData=list(CLL_covariates[,1]))
```
Then HOSVD was applied to a tensor
```{r}
HOSVD <- computeHosvd(Z,scale=FALSE)
```
Next we select singular value vectors attributed to samples.
In order to select those distinct between male (m) and female (f),
we set conditions as
```{r}
cond <- list(attr(Z,"sampleData")[[1]],attr(Z,"sampleData")[[1]],seq_len(4))
```
Interacitve more can be activated as
```
input_all <- selectSingularValueVectorLarge(HOSVD,cond)
```
But here in order to include TDbasedUFEadv into package, we are forced to
execute function as bacth mode as
```{r}
input_all <- selectSingularValueVectorLarge(HOSVD,cond,input_all=c(12,1))
```
Finally,  we perform the following function to select features in individual 
omics profiles in an interative mode
```
HOSVD$U[[1]] <- HOSVD$U[[2]] #selectFeatureSquareのHOSVD$U[[1]]を[[2]]にすればこれは不要
index_all <- selectFeatureSquare(HOSVD,input_all,CLL_data,
                                 de=c(0.5,0.1,0.1,1))
```

``` {r, fig.keep="none"}
HOSVD$U[[1]] <- HOSVD$U[[2]] #selectFeatureSquareのHOSVD$U[[1]]を[[2]]にすればこれは不要
index_all <- selectFeatureSquare(HOSVD,input_all,CLL_data,
                                 de=c(0.5,0.1,0.1,1),interact=FALSE)
```
```{r}
for (id in c(1:4))
{
    attr(Z,"feature") <- rownames(CLL_data[[id]])
    print(tableFeatures(Z,index_all[[id]]))
}
```
